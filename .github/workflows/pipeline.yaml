on:
  push:
    branches:
      - dev
      - prod
      - c/use-workspaces
  
jobs:
  setup:
    name: Pipeline
    runs-on: ubuntu-latest
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_REGION: us-east-1
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: 16.x
      - name: Install Toolchain
        run: |
          sudo apt-get update -y
          sudo apt-get install git -y
      - name: Install
        run: yarn --frozen-lockfile
      - name: Build
        run: COMMIT_HASH=${{ env.GITHUB_SHA }} yarn run build
      - name: Deploy Backend Code
        run: COMMIT_HASH=${{ env.GITHUB_SHA }} bash ./scripts/deploy-lambda.sh

